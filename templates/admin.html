<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Panel NFC</title>
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='css/pages/admin.css') }}"
        />
    </head>
    <body>
        <h1>üîê Administraci√≥n de Tarjetas NFC</h1>
        <details class="card form-container">
            <summary>
                <h2>‚ûï Agregar/Editar Usuario</h2>
            </summary>

            <form id="userForm">
                <div class="form-group-row">
                    <div class="form-group">
                        <label for="inputId">Id:</label>
                        <input type="text" id="inputId" name="Id" required />
                    </div>
                    <div class="form-group">
                        <label for="inputNombre">Nombre:</label>
                        <input type="text" id="inputNombre" name="nombre" required />
                    </div>
                    <div class="form-group">
                        <label for="inputAPaterno">Apellido Paterno:</label>
                        <input type="text" id="inputAPaterno" name="aPaterno" required />
                    </div>
                    <div class="form-group">
                        <label for="inputAMaterno">Apellido Materno:</label>
                        <input type="text" id="inputAMaterno" name="aMaterno" />
                    </div>
                </div>

                <div class="form-group-row">
                    <div class="form-group">
                        <label for="inputEmail">Email:</label>
                        <input type="email" id="inputEmail" name="email" required />
                    </div>
                    <div class="form-group">
                        <label for="inputPwd">Contrase√±a (PWD):</label>
                        <input type="password" id="inputPwd" name="pwd" placeholder="Dejar vac√≠o para no cambiar" />
                    </div>
                    <div class="form-group">
                        <label for="inputCell">Tel√©fono (Cell):</label>
                        <input type="text" id="inputCell" name="cell" />
                    </div>
                </div>

                <div class="form-group-row">
                    <div class="form-group">
                        <label for="selectTipo">Tipo ID:</label>
                        <select id="selectTipo" name="tipo">
                            <option value="">Selecciona un tipo de usuario</option>
                            {% for id,tipo in tipoUsuario %}
                                <option value="{{id}}">{{tipo}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="form-group-row control-row">
                    <div>
                        <label for="checkOperador">Operador:</label>
                        <input type="checkbox" id="checkOperador" name="operador" value = '1' />
                    </div>

                    <div>
                        <label for="checkActivo">Activo:</label>
                        <input type="checkbox" id="checkActivo" name="activo" value = '1' checked />
                    </div>
                    <div>
                        <button type="submit" id="saveButton" class="btn primary">
                            üíæ Guardar Usuario
                        </button>
                        <button type="button" id="cancelButton" class="btn secondary" style="display: none">
                            Cancelar Edici√≥n
                        </button>
                    </div>
                </div>
            </form>
            <p><a href="/">‚¨ÖÔ∏è Volver al videoportero</a></p>
        </details>

        <h2>Tarjetas registradas</h2>
        <!------------------ Barra de b√∫squeda ---------------->
        <div class="search-box">
            <input
                type="text"
                id="busqueda"
                placeholder="Buscar por nombre, apellido, email o ID..."
            />
            <button onclick="buscarUsuarios()">Buscar</button>
            <button onclick="limpiarBusqueda()">Limpiar</button>
        </div>

        <!-- Controles de paginaci√≥n superior -->
        <div class="pagination" id="paginacionSuperior">
            <!-- Se llena din√°micamente -->
        </div>

        <!-- Tabla de usuarios -->
        <div id="tablaUsuarios">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th>Tipo</th>
                        <th>Tel√©fono</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="cuerpoTabla">
                    <!-- Se llena din√°micamente -->
                </tbody>
            </table>
        </div>

        <!-- Loading indicator -->
        <div class="loading" id="loading">Cargando usuarios...</div>

        <!-- Controles de paginaci√≥n inferior -->
        <div class="pagination" id="paginacionInferior">
            <!-- Se llena din√°micamente -->
        </div>

        <!-- Informaci√≥n de paginaci√≥n -->
        <div id="infoPaginacion"></div>
    </div>

        <!--<table id="userTable">
            <tr><th>ID</th><th>Nombre</th><th>Email</th><th>TipoUsuario</th>
                <th>Activo</th><th>Operador</th><th>Acciones</th>
            </tr>
            {% for id, nombre, ap, am, email, tipo, activo, operador in usuarios %}
            <tr>
            <td>{{ id }}</td>
            <td>
                <form action="/admin/update/{{ id }}" method="POST">
                    <input name="nombre" value="{{ nombre }} {{ ap }} {{ am }}">
                    </td>
                    <!--<td><input name="APaterno" value="{{ ap }}"></td>
                    <td><input name="AMaterno" value="{{ am }}"></td>-->
                    <td><input name="Email" value="{{ email }}"></td>
                    <td>
                        <select name="tipoId">
                            {% for id, tipo in tipoUsuario %}
                            <option
                                value="{{ id }}"
                                {% if id == tipoId %}selected{% endif %}>
                                {{ tipo }}
                            </option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input name="activo" type="checkbox" value="1"
                            {% if activo==1 %}checked{% endif %}
                        >
                    </td>
                    <td>
                        <input name="operador" type="checkbox" value="1"
                            {% if operador==1 %}checked{% endif %}
                        >
                    </td>
                    <td>
                        <button title="Editar">‚úèÔ∏è</button>
                </form>
            <form action="/admin/delete/{{ id }}" method="POST" onsubmit="return confirm('¬øEliminar tarjeta?')">
                <button title="Borrar" style="background:#a00;">üóëÔ∏è</button>
            </form>
            </td>
            </tr>
            {% endfor %}
        </table>-->


        <!-- JavaScript para manejar el env√≠o del formulario -->
        <script src="{{ url_for('static', filename='js/pages/admin/crud.js') }}"></script>
        <script src="{{ url_for('static', filename='js/pages/admin/paginado.js') }}"></script>
        <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
        <script src="{{ url_for('static', filename='js/pages/admin/sockets.js') }}"></script>
        <div id="nfc-status"></div>
    </body>
</html>
